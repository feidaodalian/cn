# 后端服务管理
后端服务管理用来指导您新建一个后端服务和管理已有后端服务。
 -  新建后端服务：新建后端服务向导将指引您新建一个后端服务。该向导包括基本信息配置、健康检查配置和后端服务器组配置三部分。
 -  管理后端服务：您可以对已有后端服务进行编辑、删除等操作。
## 操作步骤
### 步骤一：基本信息配置
1.您可以在网络负载均衡列表页通过以下两种方式，进入后端服务列表页。

  - 点击 **名称**  栏下的指定网络负载均衡，进入该网络负载均衡详情页。点击 **后端服务** 页签，进入后端服务列表页。
  -  点击 **操作** 栏下的 **添加监听** 链接，进入监听器列表页。点击 **后端服务** 页签，进入后端服务列表页。
    
2.点击 **新建后端服务** 按钮，在弹出的对话框中配置后端服务名称、后端协议等参数。

| 参数	| 说明	| 
| :- | :- |
|后端协议	|后端服务器提供服务时使用的协议。默认显示为TCP|
|端口	|后端服务器接收服务请求的端口，输入范围为1-65535。不同后端服务的端口可以重复|
|调度算法|网络负载均衡将服务请求分发到后端服务器的算法，取值包括：<br><br>● **加权源IP**：基于源IP地址进行的哈希算法。在后端服务器列表不变的情况下，相同源IP地址的服务请求将分发到同一台后端服务器。如增加或减少后端服务器，将可能导致源IP地址的服务请求转发到不同的后端服务器。同时可配置后端服务器的权重，按权重比例分发服务请求<br><br>● **加权五元组**：基于报文五元组（协议、源IP、源端口、目的IP和目的端口）进行的哈希算法，报文五元组相同的服务请求将分发到同一台后端服务器。同时可配置后端服务器的权重，按权重比例分发服务请求<br><br>● **加权最小连接数**：基于负载均衡与后端服务器建立的连接数进行的哈希算法，新建连接请求将被分发到连接数最小的后端服务器。同时可配置后端服务器的权重，按权重比例分发服务请求|
|会话保持	|支持基于源IP地址的会话保持功能。开启本功能后，无论使用哪种调度算法，相同源IP的服务请求都将转发到同一台后端服务器。增加后端服务器，已有相同源IP的服务请求仍转发到同一后端服务器；移除后端服务器，仅影响移除的后端服务器上的服务请求转发到其他后端服务器。会话保持超时时间为300秒|
|连接耗尽	|连接耗尽超时时间，范围为【0，3600】秒，缺省为300秒。后端服务器从负载均衡的服务器组移除后，超时时间内已有连接继续转发流量，新建连接将不再调度到该台后端服务器，以保证后端服务优雅移除|
 
      > 注意事项：当客户端源IP数量较少并且业务类型为无状态业务时，推荐使用加权五元组算法，这样可使业务请求更均匀的分布到不同的后端服务器

3.点击 **下一步** 进入健康检查配置页签。

### 步骤二：健康检查配置

 1.配置向导中健康检查默认开启，可配置健康检查参数。如您需将其关闭，请在后端服务的编辑对话框中进行操作。
 
| 参数	| 说明	| 
| :- | :- |
|健康检查方式|对后端服务器进行健康检查时的探测协议，支持TCP、HTTP|
|检查端口|对后端服务器进行健康检查时的探测端口，输入范围为1-65535。如不填写本参数，默认使用后端服务端口|
|响应超时时间(s)|健康检查响应的最大超时时间。如在指定时间内未接收到后端服务器的正确响应，网络负载均衡将判定该后端服务器为异常。输入范围为2-60秒|
|健康检查间隔(s)|对后端服务器进行健康检查的时间间隔。输入范围为5-300秒|
|不健康阈值|对后端服务器从成功到失败的连续健康检查失败次数。输入范围为1-5|
|健康阈值|对后端服务器从失败到成功的连续健康检查成功次数。输入范围为1-5|
|检查路径|仅健康检查方式为HTTP时填写，必须以“/”开头、最多支持5级目录，不得超过100字符|
|检查域名|健康检查的域名。支持输入域名和IP地址。如果输入域名，仅支持大小写字母、数字、英文中划线"-"和点"."，不区分大小写，且不超过255个字符。默认为空，表示健康检查不携带域名。仅健康检查方式为HTTP时支持填写。|

2.点击 **下一步** 进入后端服务器组配置页签。
 
### 步骤三：后端服务器组
1.选择服务器组类型：虚拟服务器组、高可用组或暂不添加。

   - 选择虚拟服务器组：系统会自动筛选出当前可以绑定的虚拟服务器组列表，如没有可用的虚拟服务器组，可点击 **新建服务器组** 进行创建。
   - 选择高可用组：系统会自动筛选出当前可以绑定的高可用组，如没有可用的高可用组，请前往高可用组页面进行创建。
   
         注意：
         * 服务器组中的后端实例必须与网络负载均衡属于同一地域和私有网络。
         * 高可用组中的后端实例不支持配置权重和端口号，组内所有后端实例的权重相同，端口号使用后端服务的端口号。
        
2.如选择新建虚拟服务器组，页面自动跳转到虚拟服务器组列表页。请参见[虚拟服务器组管理](../Operation-Guide/TargetGroup-Management.md)新建一个虚拟服务器组。

3.选择新建的虚拟服务器组名称，点击 **确定** ，完成创建后端服务的操作。

### 管理后端服务

 1.查看后端服务详情：点击 **名称**  栏下的指定后端服务，进入详情页查看其详细信息。
 
 2.更改绑定的服务器组：在后端服务详情页，点击 **服务器组** 区域下的 **更改** 按钮，可更改后端服务绑定的服务器组。
 
 3.编辑后端服务：点击 **操作** 栏下的 **编辑**，在弹出的对话框中可修改后端服务的信息。
 
         注意：
         * 健康检查开关状态仅支持在编辑后端服务对话框中修改。网络负载均衡通过健康检查功能检测后端服务器的运行状况，当检测到后端服务故障时，将不再向其分发流量，从而保证业务的整体可用性。不建议将健康检查开关关闭。
         * 关闭健康检查开关后，后端服务器的健康状态将显示为“N/A”，此时负载均衡将流量按照调度算法分发到所有“运行中”的后端服务器。

 4.删除后端服务：点击 **操作** 栏下的 **删除**，可删除指定后端服务。
 
         注意：
         * 删除成功后，后端服务将与绑定的服务器组自动解除关联。
         * 已关联监听器的后端服务不可删除。
       
 5.查看后端服务器信息：点击 **服务器组**  栏下的指定服务器组，可查看组内所有后端服务器的健康状态等信息。


