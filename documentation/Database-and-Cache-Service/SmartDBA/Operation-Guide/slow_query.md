# 慢查询

通过慢查询功能可以图形化展示慢查询次数趋势和慢查询耗时分布折线图，并且通过列表展示慢SQL统计和慢SQL明细情况，让用户查看获取慢SQL更加详细的信息，以及诊断慢SQL，展示优化建议。

## 前置条件

* 已创建数据库实例，数据库类型目前支持MySQL、Percona
* 数据库实例已接入SmartDBA服务

## 操作序列

控制台->数据库与缓存->SmartDBA->实例监控->实例监控详情->慢查询。


## 查看慢查询次数趋势和慢查询耗时


![](../../image/SmartDBA/slow_query.png)

* 图表展示：
	
	* 图表展示为两个折线图，分别为慢查询次数趋势和慢查询耗时分布。
	* 慢查询次数：展示时间周期内，慢查询次数折线图
    * 慢查询耗时分布：多条折线，按照0-0.1s，0.1-0.5s，0.5-1s，1-3s和>3s,5条折线分别展示耗时分布。

* 列表展示：

    * 慢SQL统计：
	  
	    | 列表项         | 说明                                                         |
        | ---------------| ------------------------------------------------------------ |
        | 数据库         | 展示数据库名称 |
        | 慢SQL模板      | 鼠标悬浮展示SQL详情 |
        | 执行次数       |  |
        | 平均执行时间   | 单位：秒 |
	    | 最长执行时间   | 单位：秒 |
		| 平均锁等待时间 | 单位：秒 |
	    | 最长锁等待时间 | 单位：秒 |
        | 平均扫描行数   | 小于1000行，展示数字。大于等于1000行，小于1000000行，展示为（x）K，x保留小数点后２位。大于等于1000000行，展示为（x）M，x保留小数点后２位。|
	    | 最大扫描行数   | 同上 |
		| 平均返回行数   | 同上 |
	    | 最大返回行数   | 同上 |	

	* 慢SQL明细：
	  
	    | 列表项         | 说明                                                         |
        | ---------------| ------------------------------------------------------------ |
        | 数据库         | 展示数据库名称 |
        | SQL语句        |  |
        | 执行时间       | 单位：秒 |
        | 锁等待时间     | 单位：秒 |
	    | 扫描行数       | 小于1000行，展示数字。大于等于1000行，小于1000000行，展示为（x）K，x保留小数点后２位。大于等于1000000行，展示为（x）M，x保留小数点后２位。|
		| 返回行数       | 同上 |
	    | 开始时间       | YYYY:MM:DD hh:mm:ss 精确到秒 |
        | 用户名         |  |
	    | 客户端IP       | 返回用户客户端IP |


## 查看慢SQL统计和慢SQL明细

如上图中的慢SQL统计和慢SQL明细列表

SQL优化信息展示：
1）SQL：展示完整SQL语句。
2）执行计划：
3）诊断情况：展示SQL执行的诊断情况。
4）诊断结果（优化建议）：展示SQL诊断的优化建议及结果。

