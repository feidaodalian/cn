# 数据源配置

组件的数据源为组件提供数据，当前莫奈产品中共支持以下三种类型的数据源。

## 静态数据

![](http://storage.360buyimg.com/docs-image/6f41f011e60f810172624fac00c2883d.png)

选中组件，右侧出现次组件的数据配置框，组件数据源的静态数据支持json格式的静态数据。按照选中组件要求的数据格式书写或者将已经处理好的数据粘贴进来即可。

## API

![](http://storage.360buyimg.com/docs-image/540911bc22aa06204c66836443a6f455.png)

选中组件，右侧出现本组件的数据配置框，切换数据源类型为API，将API的链接粘贴到输入框中即可。

::: tip 注意

API类数据源支持嵌套的参数，
例如：api返回的数据为

``` js

{
	a: "我是第一层数据",
	b: {
		c: "我是第二层数据P",
		d: "我是第二层数据Q"
	}
}

```

如果用户需要取c的结果作为图表的字段，则可使用"b.c"作为映射字段即可。

::: 

::: tip 注意

API默认支持域名或公网IP的URL，若想使用内网IP的URL，请联系管理员或客户经理添加白名单。

::: 

可选择是否自动更新数据，以及自动更新数据的频率，假定选中自动更新数据，每5秒更新一次，择莫奈将会每5秒请求一次填入的接口来获取数据。

## 数据库

组件的数据源中对数据库的支持当前包含六类数据库，MySQL、Oracle、SQLServer、DB2、PostgreSQL、CSV、EXCEL、ClickHouse、基于城市操作系统的MySQL库和Hive库。除城市操作系统中的MySQL库和hive库外，其他数据库均需要在数据源中进行单独配置。

### 配置数据源

![](http://storage.360buyimg.com/docs-image/1591324091.png)

上图中展示的为莫奈中的数据源列表，组件如果选择了通过数据库方式获取数据，则只有在此配置好数据库才能在大屏配置中展示正确的数据。本页面列表支持按照数据源类型以及数据源名称进行模糊搜索，同时支持添加、编辑和删除操作。

数据源类型显示此数据源的文件类型。

归属显示此数据源所属的大屏名称。

- 添加数据源

![](http://storage.360buyimg.com/docs-image/1593598267.png)


在数据源列表中右上方，点击【添加数据源】按钮，页面跳转至数据源类型选择页面，如下图：

![](http://storage.360buyimg.com/docs-image/532e1a295b4046caabe1cadba3f04787.png)

以MySQL数据源的配置为例，在上图中填写数据源的必要信息，完成数据库的配置。

- 编辑数据源

![](http://storage.360buyimg.com/docs-image/839ce4b731b240f0a37734e6e5c901ef.png)

在数据源列表中，鼠标滑过某个数据源，会出现编辑按钮，点击【编辑】按钮，可进行数据源的编辑操作。注意，编辑时，无法进行数据源密码的编辑。

- 删除数据源

![](http://storage.360buyimg.com/docs-image/7c5e8a8334054e469a7624849e01b209.png)

在数据源列表中，鼠标滑过某个数据源，会出现删除按钮，点击【删除】按钮，弹出删除确认提示，点击确定，完成数据源的删除操作。

- 下载数据源

  

  ![](http://storage.360buyimg.com/docs-image/1590661205.png)

  点击下载，即可下载数据源


### MySQL

![](http://storage.360buyimg.com/docs-image/90a5f833efa34442803e3620ba73e6a6.png)

选中组件，右侧出现次组件的数据配置框，切换数据源类型为数据库，选择MySQL，选择在数据源中配置的MySQL库名，即可链接到MySQL库。在输入框中输入要查询申请SQL语句，完成数据的查询。SQL语句返回的数据格式要能组成组件要求的数据源格式，莫奈会自动通过接口将数据库查询出的结果转为json格式。

同时，莫奈平台还可支持选择是否自动更新数据，以及自动更新数据的频率，假定选中自动更新数据，每5秒更新一次，则莫奈将会每5秒通过SQL语句查询一次数据库来获取数据，进行对数据的更新。

### Oracle

![](http://storage.360buyimg.com/docs-image/90a5f833efa34442803e3620ba73e6a6.png)

选中组件，右侧出现次组件的数据配置框，切换数据源类型为数据库，选择Oracle，选择在数据源中配置的Oracle库名，即可链接到Oracle库。在输入框中输入要查询的语句，完成数据的查询。查询语句返回的数据格式要能组成组件要求的数据源格式，莫奈会自动通过接口将数据库查询出的结果转为json格式。

同时，莫奈平台还可支持选择是否自动更新数据，以及自动更新数据的频率，假定选中自动更新数据，每5秒更新一次，则莫奈将会每5秒通过SQL语句查询一次数据库来获取数据，进行对数据的更新。

### SQL Server

![](http://storage.360buyimg.com/docs-image/90a5f833efa34442803e3620ba73e6a6.png)

选中组件，右侧出现次组件的数据配置框，切换数据源类型为数据库，选择SQL Server，选择在数据源中配置的SQL Server库名，即可链接到SQL Server库。在输入框中输入要查询的语句，完成数据的查询。查询语句返回的数据格式要能组成组件要求的数据源格式，莫奈会自动通过接口将数据库查询出的结果转为json格式。

同时，莫奈平台还可支持选择是否自动更新数据，以及自动更新数据的频率，假定选中自动更新数据，每5秒更新一次，则莫奈将会每5秒通过SQL语句查询一次数据库来获取数据，进行对数据的更新。

### DB2

![](http://storage.360buyimg.com/docs-image/90a5f833efa34442803e3620ba73e6a6.png)

选中组件，右侧出现次组件的数据配置框，切换数据源类型为数据库，选择DB2，选择在数据源中配置的DB2库名，即可链接到DB2库。在输入框中输入要查询的语句，完成数据的查询。查询语句返回的数据格式要能组成组件要求的数据源格式，莫奈会自动通过接口将数据库查询出的结果转为json格式。

同时，莫奈平台还可支持选择是否自动更新数据，以及自动更新数据的频率，假定选中自动更新数据，每5秒更新一次，则莫奈将会每5秒通过SQL语句查询一次数据库来获取数据，进行对数据的更新。

### PostgreSQL

![](http://storage.360buyimg.com/docs-image/90a5f833efa34442803e3620ba73e6a6.png)

选中组件，右侧出现次组件的数据配置框，切换数据源类型为数据库，选择PostgreSQL，选择在数据源中配置的PostgreSQL库名，即可链接到PostgreSQL库。在输入框中输入要查询的语句，完成数据的查询。查询语句返回的数据格式要能组成组件要求的数据源格式，莫奈会自动通过接口将数据库查询出的结果转为json格式。

同时，莫奈平台还可支持选择是否自动更新数据，以及自动更新数据的频率，假定选中自动更新数据，每5秒更新一次，则莫奈将会每5秒通过SQL语句查询一次数据库来获取数据，进行对数据的更新。

### Hive for UCP

![](http://storage.360buyimg.com/docs-image/90a5f833efa34442803e3620ba73e6a6.png)

选中组件，右侧出现次组件的数据配置框，切换数据源类型为数据库，选择Hive for UCP，选择在城市操作系统中对应的hive库名，即可链接到城市操作系统中的hive库。在输入框中输入要查询的语句，完成数据的查询。查询语句返回的数据格式要能组成组件要求的数据源格式，莫奈会自动通过接口将数据库查询出的结果转为json格式。

同时，莫奈平台还可支持选择是否自动更新数据，以及自动更新数据的频率，假定选中自动更新数据，每5秒更新一次，则莫奈将会每5秒通过SQL语句查询一次数据库来获取数据，进行对数据的更新。

### MySQL for UCP

![](http://storage.360buyimg.com/docs-image/ec83e27d1f9640b9b5c8aadb26a1a1be.png)

选中组件，右侧出现次组件的数据配置框，切换数据源类型为数据库，选择MySQL for UCP，选择在城市操作系统中对应的MySQL库名，即可链接到城市操作系统中的MySQL库。在输入框中输入要查询的语句，完成数据的查询。查询语句返回的数据格式要能组成组件要求的数据源格式，莫奈会自动通过接口将数据库查询出的结果转为json格式。

同时，莫奈平台还可支持选择是否自动更新数据，以及自动更新数据的频率，假定选中自动更新数据，每5秒更新一次，则莫奈将会每5秒通过SQL语句查询一次数据库来获取数据，进行对数据的更新。

### CSV

![](http://storage.360buyimg.com/docs-image/3a77bc2c7de84f72b3ff36a3207254fd.png)

选中组件，右侧出现次组件的数据配置框，切换数据源类型为数据库，选择CSV，选择在数据源配置中填写的数据源名，即可链接上传的CSV文件。在输入框中输入要查询的SQL语句，完成数据的查询。查询语句返回的数据格式要能组成组件要求的数据源格式，莫奈会自动通过接口将数据库查询出的结果转为json格式。

同时，莫奈平台还可支持选择是否自动更新数据，以及自动更新数据的频率，假定选中自动更新数据，每5秒更新一次，则莫奈将会每5秒通过SQL语句查询一次数据库来获取数据，进行对数据的更新。

::: tip 注意

1、上传CSV文件后，系统会使用CSV的文件名称作为表名称；

2、查询语句的样式应该与此类似：select "列名","列名" from "csv的文件名"；

:::

### EXCEL

![](http://storage.360buyimg.com/docs-image/dfd7b407e1d34e9e9836afd3a775ba5e.png)

选中组件，右侧出现次组件的数据配置框，切换数据源类型为数据库，选择EXCEL，选择在数据源配置中填写的数据源名，即可链接上传的EXCEL文件。在输入框中输入要查询的SQL语句，完成数据的查询。查询语句返回的数据格式要能组成组件要求的数据源格式，莫奈会自动通过接口将数据库查询出的结果转为json格式。

同时，莫奈平台还可支持选择是否自动更新数据，以及自动更新数据的频率，假定选中自动更新数据，每5秒更新一次，则莫奈将会每5秒通过SQL语句查询一次数据库来获取数据，进行对数据的更新。

::: tip 注意

1、上传excel文件后，系统会将excel中的所有sheet均映射成对应的表，并以sheet的名称分别作为表名称；

2、查询语句的样式应该与此类似：select "列名A","列名B" from "excel的第一个sheet页名称" ，select "列名C","列名D" from "excel的第二个sheet页名称"；

:::


::: tip 注意
此处支持的hive for UCP库为城市操作系统中的hive库;
此处支持的MySQL for UCP库为城市操作系统中的MySQL库;
:::

# 数据过滤器

用户可以使用数据过滤器完成数据的过滤，数据字段的格式调整等操作。

新增一个组件后，打开组件是数据设置，当用户选择数据源类型为API或者数据库类型时，将会看到“开启数据过滤”的选项以及“配置数据过滤器”的按钮，如图所示：

![](http://storage.360buyimg.com/docs-image/20201010153504.png)

当用户获取源数据后仍需要做进一步处理时，即可使用数据过滤器功能，该功能给用户提供了对已经获取的数据进行进一步修饰的能力。

我们以列表为例，首先打开一个列表，选择API方式获取数据，点击“查看数据响应结果”，如下图所示：

![](http://storage.360buyimg.com/docs-image/20201010154324.png)

如图所示，列表中已经显示出原始API中获取的数据，现在我们配置一个新的数据过滤器：

点击“配置数据过滤器”按钮：

![](http://storage.360buyimg.com/docs-image/20201010155012.png)

点击“新增数据过滤器”，在函数中我们已经看到了预设的几个函数，用户也可以通过自己编写JS代码实现其他功能。

![](http://storage.360buyimg.com/docs-image/20201010155213.png)

简单举例，我们希望实现在刚才的列表中，只展示分数在90分以上的学生信息，则可以写入代码：


``` js
return data.filter(item=>Number(item.grade)>90);
return data
```

则一个对grade进行数据筛选的数据过滤器就制作完成，我们点击应用，并点击调试，在数据调试结果中看到已经筛选完成，我们点击完成：

![](http://storage.360buyimg.com/docs-image/20201010155609.png)

勾选“开启数据过滤”选项，我们获得了数据过滤后的数据：

![](http://storage.360buyimg.com/docs-image/20201010155722.png)

# 统一数据请求

针对大屏新增统一数据请求设置，用户可以在大屏的数据配置中新增数据设置，添加一个可以让当前大屏下所有组件都可以使用的“统一数据设置”。

![image-20210425140957165](https://raw.githubusercontent.com/zhangzhenjiang1/Alotofphotos/master/img/image-20210425140957165.png)

在这里设置的数据，大屏中所有的组件将都可以使用。

统一数据配置中，我们也依旧支持数据库，API和静态数据这三种类型：

![image-20210425141132635](https://raw.githubusercontent.com/zhangzhenjiang1/Alotofphotos/master/img/image-20210425141132635.png)

在配置完数据后，大屏中所有组件都可以直接使用统一数据配置中配置的数据源。

![image-20210425141247123](https://raw.githubusercontent.com/zhangzhenjiang1/Alotofphotos/master/img/image-20210425141247123.png)

推荐各位首先使用统一数据源的数据配置。

## 保存已有组件的独立数据请求配置

当一个组件的数据配置需要被应用到其他组件上时，您可以直接使用“另存为统一数据请求”的功能。

例如一个组件的数据设置，与其他组件的数据设置一致，或者包含了其他组件的数据设置，则您可以选择将这个组件的数据设置保存为“统一数据请求"供其他组件使用。

![image-20210425142315512](https://raw.githubusercontent.com/zhangzhenjiang1/Alotofphotos/master/img/image-20210425142315512.png)

您也可以在保存时直接在当前组件使用统一数据请求，选择“另存为且应用”即可。

![image-20210425142356093](https://raw.githubusercontent.com/zhangzhenjiang1/Alotofphotos/master/img/image-20210425142356093.png)

